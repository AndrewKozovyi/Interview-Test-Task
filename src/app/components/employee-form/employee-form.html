<form [formGroup]="employeeForm" class="employee-form" (ngSubmit)="onSubmit()">
  <mat-dialog-content>
      <h1 class="form-title">Add Employee</h1>

      <div class="form-grid">
        <div class="form-group">
          <label for="full-name">Full Name</label>

          <input
            pInputText
            id="full-name"
            placeholder="Full name"
            type="text"
            (blur)="fullName.invalid && fullName.markAsDirty()"
            formControlName="fullName"
            [class.ng-invalid]="fullName.invalid && (fullName.dirty || !fullName.untouched)"
          />

          @if (fullName.invalid && (fullName.dirty || !fullName.untouched)){
            <div class="error-message">
              @if (fullName.hasError('required')){
                <p>Full name can't be empty.</p>
              }

              @if (fullName.hasError('minlength')){
                <p>Full name can't be empty.</p>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="email">Email</label>

          <input
            pInputText
            id="email"
            placeholder="Email"
            type="text"
            (blur)="email.invalid && email.markAsDirty()"
            formControlName="email"
            [class.ng-invalid]="email.invalid && (email.dirty || !email.untouched)"
          />

          @if (email.invalid && (email.dirty || !email.untouched)){
            <div class="error-message">
              @if (email.hasError('required')){
                <p>Email can't be empty.</p>
              }

              @if (email.hasError('email')){
                <p>Please enter a valid email address.</p>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="position">Position</label>

          <p-select
            id="position"
            [options]="positionsList"
            formControlName="position"
            placeholder="Select a position"
            [showClear]="true"
            (onBlur)="position.invalid && position.markAsDirty()"
            [class.ng-invalid]="position.invalid && (position.dirty || !position.untouched)"
            appendTo="body"
          ></p-select>

          @if (position.invalid && (position.dirty || !position.untouched)){
            <div class="error-message">
              @if (position.hasError('required')){
                <p>A position must be selected.</p>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label>Start Date</label>

          <p-datepicker
            placeholder="Select a start date"
            formControlName="startDate"
            dateFormat="mm/dd/yy"
            [showIcon]="true"
            (onBlur)="startDate.invalid && startDate.markAsDirty()"
            [class.ng-invalid]="startDate.invalid && (startDate.dirty || !startDate.untouched)  "
            appendTo="body"
          ></p-datepicker>

          @if (startDate.invalid && (startDate.dirty || !startDate.untouched)){
            <div class="error-message">
              @if (startDate.hasError('required')){
                <p>A start date must be selected.</p>
              }
            </div>
          }
        </div>
      </div>

      <div class="skills-section" formArrayName="skills">
        <div class="skills-header">
          <label class="section-title">Skills</label>
          <button
            type="button"
            pButton
            label="Add Skill"
            icon="pi pi-plus"
            class="p-button-primary p-button-sm"
            [disabled]="skills.length === masterSkillsList.length"
            (click)="addSkill()"
          ></button>
        </div>

        <div
          class="skill-row"
          *ngFor="let skillGroup of skills.controls; let i = index"
          [formGroupName]="i"
        >
          <div class="skill-field">
            <label [for]="'skill-' + i">Skill</label>
            <p-select
              [id]="'skill-' + i"
              [options]="getAvailableSkills(skillGroup.controls.skill.value)"
              formControlName="skill"
              placeholder="Select a skill"
              appendTo="body"
              (onBlur)="skillGroup.get('skill')?.markAsDirty()"
              [class.ng-invalid]="
                skillGroup.get('skill')?.invalid && skillGroup.get('skill')?.dirty
              "
            ></p-select>

            @if (skillGroup.get('skill')?.invalid && skillGroup.get('skill')?.dirty){
              <div class="error-message">
                @if (skillGroup.get('skill')?.hasError('required')){
                  <p>Skill must be selected.</p>
                }
              </div>
            }
          </div>

          <div class="years-field">
            <label [for]="'years-' + i">Years</label>
            <p-inputNumber
              [id]="'years-' + i"
              formControlName="yearExperience"
              [min]="0"
              placeholder="Years"
              [showButtons]="false"
              [class.ng-invalid]="skillGroup.get('yearExperience')?.invalid && skillGroup.get('yearExperience')?.dirty"
            ></p-inputNumber>

            @if (skillGroup.get('yearExperience')?.invalid && skillGroup.get('yearExperience')?.dirty){
              <div class="error-message">
                @if (skillGroup.get('yearExperience')?.hasError('required')){
                  <p>Experience can't be empty.</p>
                }
              </div>
            }
          </div>

          <button
            type="button"
            pButton
            icon="pi pi-trash"
            class="p-button-danger p-button-sm remove-btn"
            (click)="removeSkill(i)"
          ></button>
        </div>
      </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button class="cancel-btn" (click)="onCancel()">Cancel</button>
    <button mat-button class="submit-btn" type="submit" [disabled]="employeeForm.invalid">Submit</button>
  </mat-dialog-actions>
</form>
